{"version":3,"file":"ng-add.js","sourceRoot":"","sources":["../ng-add.ts"],"names":[],"mappings":";;;;;;;;;;;;AAAA,+CAAkD;AAClD,2DAIoC;AACpC,mCAAqC;AAM9B,MAAM,KAAK,GAAG,CAAC,OAAqB,EAAE,EAAE,CAAC,CAC9C,IAAU,EACV,QAA0B,EAC1B,EAAE;;IACF,MAAM,IAAI,GAAG,kBAAU,CAAC,IAAI,CAAC,CAAC;IAC9B,MAAM,EAAE,SAAS,EAAE,GAAG,MAAM,iBAAU,CAAC,aAAa,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC;IAEhE,IAAI,CAAC,OAAO,CAAC,OAAO,EAAE;QAEpB,IAAI,SAAS,CAAC,UAAU,CAAC,cAAc,EAAE;YACvC,OAAO,CAAC,OAAO,GAAG,SAAS,CAAC,UAAU,CAAC,cAAwB,CAAC;SACjE;aAAM,IAAI,SAAS,CAAC,QAAQ,CAAC,IAAI,KAAK,CAAC,EAAE;YAExC,OAAO,CAAC,OAAO,GAAG,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;SAC5D;aAAM;YACL,MAAM,IAAI,gCAAmB,CAC3B,8GAA8G,CAC/G,CAAC;SACH;KACF;IAED,MAAM,OAAO,GAAG,SAAS,CAAC,QAAQ,CAAC,GAAG,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;IACxD,IAAI,CAAC,OAAO,EAAE;QACZ,MAAM,IAAI,gCAAmB,CAC3B,gEAAgE,CACjE,CAAC;KACH;IAED,IAAI,OAAO,CAAC,UAAU,CAAC,WAAW,KAAK,aAAa,EAAE;QACpD,MAAM,IAAI,gCAAmB,CAC3B,0EAA0E,CAC3E,CAAC;KACH;IAED,IAAI,CAAC,CAAA,MAAA,MAAA,OAAO,CAAC,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,0CAAE,OAAO,0CAAE,UAAU,CAAA,EAAE;QACtD,MAAM,IAAI,gCAAmB,CAC3B,4FAA4F,OAAO,CAAC,OAAO,mBAAmB,CAC/H,CAAC;KACH;IAED,OAAO,CAAC,OAAO,CAAC,GAAG,CAAC;QAClB,IAAI,EAAE,QAAQ;QACd,OAAO,EAAE,4BAA4B;QACrC,OAAO,EAAE,EAAE;KACZ,CAAC,CAAC;IAEH,iBAAU,CAAC,cAAc,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC;IAC3C,OAAO,IAAI,CAAC;AACd,CAAC,CAAA,CAAC;AAhDW,QAAA,KAAK,SAgDhB","sourcesContent":["import { workspaces } from '@angular-devkit/core';\nimport {\n  SchematicContext,\n  SchematicsException,\n  Tree\n} from '@angular-devkit/schematics';\nimport { createHost } from './utils';\n\ninterface NgAddOptions {\n  project: string;\n}\n\nexport const ngAdd = (options: NgAddOptions) => async (\n  tree: Tree,\n  _context: SchematicContext\n) => {\n  const host = createHost(tree);\n  const { workspace } = await workspaces.readWorkspace('/', host);\n\n  if (!options.project) {\n    // TODO: defaultProject is deprecated as for Angular 14. Remove support here when officially removed from Angular.\n    if (workspace.extensions.defaultProject) {\n      options.project = workspace.extensions.defaultProject as string;\n    } else if (workspace.projects.size === 1) {\n      // If there is only one project, return that one.\n      options.project = Array.from(workspace.projects.keys())[0];\n    } else {\n      throw new SchematicsException(\n        'There is more than one project in your workspace. Please select it manually by using the --project argument.'\n      );\n    }\n  }\n\n  const project = workspace.projects.get(options.project);\n  if (!project) {\n    throw new SchematicsException(\n      'The specified Angular project is not defined in this workspace'\n    );\n  }\n\n  if (project.extensions.projectType !== 'application') {\n    throw new SchematicsException(\n      `Deploy requires an Angular project type of \"application\" in angular.json`\n    );\n  }\n\n  if (!project.targets.get('build')?.options?.outputPath) {\n    throw new SchematicsException(\n      `Cannot read the output path (architect.build.options.outputPath) of the Angular project \"${options.project}\" in angular.json`\n    );\n  }\n\n  project.targets.add({\n    name: 'deploy',\n    builder: 'angular-cli-ghpages:deploy',\n    options: {}\n  });\n\n  workspaces.writeWorkspace(workspace, host);\n  return tree;\n};\n"]}